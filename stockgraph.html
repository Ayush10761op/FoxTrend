<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src='https://cdn.plot.ly/plotly-2.32.0.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link rel="stylesheet" href="graphss.css">
</head>
<body>
    <div id="myplot" style="width:100%; height:100%;"></div>
    <button id="stp">Show Full Graph</button>
    <script>
        Papa.parse("stock_data_1.csv", {
            download: true,
            header: true,
            complete: function(results) {
                const xarray = [];
                const yarray = [];
                
                results.data.forEach(row => {
                    xarray.push(row['Date']);
                    yarray.push(parseFloat(row['Close']));
                });
                
                const data=[{
                    x:xarray,
                    y:[],
                    mode:"lines",
                    type:"scatter",
                    fill:"tozeroy",
                    fillgradient:{
                        type: 'vertical',
                        colorscale: [[0,'rgba(0,0,0,0)'], [1,'rgba(96,0,147,1)']],
                    },
                    line:{
                        width:2
                    }
                }];
                const layout={
                    xaxis:{range:[xarray[0], xarray[xarray.length-1]],title:{
                        text:"Date",
                        font:{
                            color:"white"
                        }
                       },
                        tickfont:{
                            color:"white"
                        }
                    },
                    yaxis:{range:[0, Math.max(...yarray)+20],title:{text:"Prices",
                        font:{
                            color:"white"
                        }
                    },
                        tickfont:{
                            color:"white"
                        }
                    },
                    colorway:['#7834a8'],
                    plot_bgcolor:"black",
                    paper_bgcolor:"black",
                };
                
                Plotly.newPlot("myplot",data,layout);
                let i = 0; let id;
                function animate() {
                    if (i < xarray.length) {
                        Plotly.extendTraces("myplot", {
                            x: [[xarray[i]]],
                            y: [[yarray[i]]]
                        }, [0])
                        i++;
                        id = requestAnimationFrame(animate);
                    }
                }
                animate();


                const stp=document.getElementById('stp')
                stp.addEventListener('click',()=>{
                   Plotly.react("myplot",[{
                    x:xarray,
                    y:yarray,
                    mode:"lines",
                    type:"scatter",
                    fill:"tozeroy",
                    fillgradient:{
                        type: 'vertical',
                        colorscale: [[0,'rgba(0,0,0,0)'], [1,'rgba(96,0,147,1)']],
                    },
                    line:{
                        width:2
                    }
                   }],layout)
                   cancelAnimationFrame(id)
                })
            }
        });
    </script>
</body>
</html>
